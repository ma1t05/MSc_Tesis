% A model for the Stochastic Queue p-Median Problem
% Created by Luis Maltos & Roger Rios
% 2015

\section{Model B}

This model
was developed with the idea
that is unlikely that the farthest adjusters
serve demand points
on cases where the system does not become congested.
In these cases
we can make the assumption that
the probability of being served by the $\ell$-th 
adjuster is almost zero,
where $\ell$ is large enough but less than $p$.

Parameters:
\begin{itemize}
\item $M$ is a large integer
\item $\ell$ the number of allowed adjusters per demand point
\item $a_{ik}$ the $k$-th preferred location server
  regarding the point $i$.
\end{itemize}

Variables:
\begin{itemize}
\item $z_j$ the number of adjusters placed at site $j$
\item $y_{ij}^k$ if adjuster in $j$,
  is the $k$-th to cover demand point $i$
\end{itemize}

The objective,
and the constraints \ref{eq:2}-\ref{eq:5} 
are practically the same as in model A,
with the difference that
binary variables $x_j$ from Model A
are replaced by integer variables $z_j$
inspired by the results of Berman \cite{berman1987stochastic},
and the addition of the following binary variables
\begin{itemize}
\item $u_{ij} = 
  \begin{cases}
    1 & \mbox{if the number of adjusters between } i 
    \mbox{ and } j \mbox{, inclusive, is less than } \ell \\
    0 & \mbox{otherwise}
  \end{cases}$
\item $v_{ij} = 
  \begin{cases} 
    1 & \mbox{if the number of adjusters between } i
    \mbox{ and } j \mbox{, is less than } \ell - 1 \\
    0 & \mbox{otherwise}
  \end{cases}$
\end{itemize}

\begin{align}
  \sum_{r \in S_{ij}\cup\{j\}}{
    z_{r}
  }
  + (p-\ell) u_{ij}
  & \leq p
  & i \in V,
  & j \in W
\end{align}
Checks if
the number of adjusters between $i$ and $j$,
inclusive,
is less or equal than $\ell$
\begin{align}
  \sum_{r \in S_{ij}\cup\{j\}}{
    z_{r}
  }
  + M u_{ij}
  & \geq \ell+1
  & i \in V,
  & j \in W
\end{align}
Checks if
the number of adjusters between $i$ and $j$,
inclusive,
is greater than $\ell$
\begin{align}
  \sum_{k = 1}^{\ell}{
    y_{ij}^{k}
  }
  + M (1 - u_{ij})
  & \geq z_j
  & i \in V,
  & j \in W
\end{align}
Assign $z_j$ times $j$ to $i$ if $u_{ij} = 1$
\begin{align}
  \sum_{r \in S_{ij}}{
    z_{r}
  }
  + (p-(\ell-1)) v_{ij}
  & \leq p
  & i \in V,
  & j \in W
\end{align}
Checks if
the number of adjusters between $i$ and $j$,
is less than $\ell$
\begin{align}
  \sum_{r \in S_{ij}}{
    z_{r}
  }
  + M v_{ij}
  & \geq \ell
  & i \in V,
  & j \in W
\end{align}
Checks if
the number of adjusters between $i$ and $j$,
is greater or equal than $\ell$
\begin{align}
  \sum_{k=1}^{\ell}{
    y_{ij}^{k}
  }
  + M (1 - v_{ij} + u_{ij})
  & \geq \ell
  - \sum_{r \in S{ij}}{
    z_{r}
  } 
  &  i \in V, j 
  & \in W
\end{align}
Assign $j$ to $i$
the times remaining to complete $\ell$ assignments
\begin{align}
  \sum_{k=1}^{\ell}{
    y_{ij}^{k}
  }
  - M (1 - v_{ij} + u_{ij})
  & \leq \ell 
  - \sum_{r \in S_{ij}}{
    z_{r}
  }
  & i \in V,
  & j \in W
\end{align}
Assign $j$ to $i$
the times remaining to complete $\ell$ assignments
\begin{align}
  y_{ij}^{k}
  & \leq u_{ij}
  + v_{ij}
  & i \in V,
  & j \in W
\end{align}
Assign $j$ to $i$
only if
is in the first $\ell$ adjusters near $i$
\begin{align}
  z_j
  & \in \{0,1,\ldots,p\}
  & j
  & \in V \nonumber
  \\
  y_{ij}^{k} 
  & \in \{0,1\}
  & i\in V,j\in W,k
  & \in I \nonumber
  \\
  u_{ij},v_{ij}
  & \in \{0,1\}
  & i \in V,j
  & \in W \nonumber
\end{align}
